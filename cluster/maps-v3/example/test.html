<html><head><title>clustering</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="../../../fast-marker-overlay/maps-v3/src/FastMarkerOverlay.js"></script>
<script src="../src/cluster.js"></script>

<style>
.cluster {
  background-color: white;
  border: 2px solid black;
  height: 2em;
  width: 2em;
  text-align: center;
  border-radius: 2em;
  -moz-border-radius: 2em;
  -webkit-border-radius: 2em;
}
.cluster div {
  padding-top: 0.45em;
}
</style>

<script>

window.onload = function initialize() {
    var latlng = new google.maps.LatLng(37.233067, -121.92083);
    var myOptions = {
      zoom: 8,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = window.map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
  }

function cluster() {
  var count = 0;
  var markers = [];
  // Add markers to the map at random locations
  var bounds = map.getBounds();
  var southWest = bounds.getSouthWest();
  var northEast = bounds.getNorthEast();
  var lngSpan = northEast.lng() - southWest.lng();
  var latSpan = northEast.lat() - southWest.lat();
  for (var i = 0; i < 500; i++) {
    var latlng = new google.maps.LatLng(southWest.lat() + latSpan * Math.random(),
                             southWest.lng() + lngSpan * Math.random());
    var marker = new com.redfin.FastMarker(/*id*/i, latlng, ["<img src='marker.png'>"]);
    markers.push(marker);
  }  
  
  var clusterToMarker = function (cluster) {
    return new com.redfin.FastMarker(cluster.id, cluster._latLng, ["<div>",cluster.count(),"</div>"], "cluster");
  }
  com.redfin.Cluster.sortedClusterListFromMarkerCollection(markers,
    function finishedCallback(clusterList) {
      var overlay = new com.redfin.ClusterOverlay(map, clusterList, markers, 300, clusterToMarker);        
    },
    function progressCallback(progress) {
      document.getElementById("count").innerHTML=progress;
    }
  );
}
</script>
<body>
    <div id="count"></div><button onclick="cluster();">cluster</button>
    <div id="map_canvas" style="width:100%; height:80%"></div>
</body>
</html>